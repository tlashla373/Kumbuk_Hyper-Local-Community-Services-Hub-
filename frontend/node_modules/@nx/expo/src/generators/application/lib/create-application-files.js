"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createApplicationFiles = createApplicationFiles;
const devkit_1 = require("@nx/devkit");
const onboarding_1 = require("nx/src/nx-cloud/utilities/onboarding");
const path_1 = require("path");
async function createApplicationFiles(host, options) {
    const packageManager = (0, devkit_1.detectPackageManager)(host.root);
    const onBoardingStatus = await (0, onboarding_1.createNxCloudOnboardingURLForWelcomeApp)(host, options.nxCloudToken);
    const connectCloudUrl = onBoardingStatus === 'unclaimed' &&
        (await (0, onboarding_1.getNxCloudAppOnBoardingUrl)(options.nxCloudToken));
    (0, devkit_1.generateFiles)(host, (0, path_1.join)(__dirname, '../files/base'), options.appProjectRoot, {
        ...options,
        offsetFromRoot: (0, devkit_1.offsetFromRoot)(options.appProjectRoot),
        packageManager,
    });
    (0, devkit_1.generateFiles)(host, (0, path_1.join)(__dirname, `../files/nx-welcome/${onBoardingStatus}`), options.appProjectRoot, {
        ...options,
        connectCloudUrl,
        offsetFromRoot: (0, devkit_1.offsetFromRoot)(options.appProjectRoot),
        packageManager,
    });
    if (options.unitTestRunner === 'none') {
        host.delete((0, path_1.join)(options.appProjectRoot, 'src/app/App.spec.tsx'));
    }
    if (options.js) {
        (0, devkit_1.toJS)(host);
    }
}
